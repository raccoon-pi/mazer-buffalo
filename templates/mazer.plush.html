<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="csrf-token" content="<%= authenticity_token %>"/>
    <title>buffalo - mazer</title>
    <%= stylesheetTag("app.css") %>
    <%= stylesheetTag("appDark.css") %>
    <link rel="shortcut icon" href="/assets/static/images/logo/favicon.svg" type="image/x-icon">
    <link rel="shortcut icon" href="/assets/static/images/logo/favicon.png" type="image/png">
</head>

<body>
    <%= javascriptTag("static/js/initTheme.js") %>
    <div id="app">
        <div id="sidebar">
            <%= partial("_partials/sidebar.html") %>
        </div>

        <div id="main" class='layout-navbar navbar-fixed'>
            <header>
                <nav class="navbar navbar-expand navbar-light navbar-top">
                    <div class="container-fluid">
                        <a href="#" class="burger-btn d-block">
                            <i class="bi bi-justify fs-3"></i>
                        </a>

                        <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                            data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                            aria-expanded="false" aria-label="Toggle navigation">
                            <span class="navbar-toggler-icon"></span>
                        </button>
                        <div class="collapse navbar-collapse" id="navbarSupportedContent">
                            <ul class="navbar-nav ms-auto mb-lg-0">
                                <li class="nav-item dropdown me-1">
                                    <a class="nav-link active dropdown-toggle text-gray-600" href="#" data-bs-toggle="dropdown"
                                        aria-expanded="false">
                                        <i class='bi bi-envelope bi-sub fs-4'></i>
                                    </a>
                                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownMenuButton">
                                        <li>
                                            <h6 class="dropdown-header">Mail</h6>
                                        </li>
                                        <li><a class="dropdown-item" href="#">No new mail</a></li>
                                    </ul>
                                </li>
                                <li class="nav-item dropdown me-3">
                                    <a class="nav-link active dropdown-toggle text-gray-600" href="#" data-bs-toggle="dropdown" data-bs-display="static" aria-expanded="false">
                                        <i class='bi bi-bell bi-sub fs-4'></i>
                                        <span class="badge badge-notification bg-danger">7</span>
                                    </a>
                                    <ul class="dropdown-menu dropdown-menu-end notification-dropdown" aria-labelledby="dropdownMenuButton">
                                        <li class="dropdown-header">
                                            <h6>Notifications</h6>
                                        </li>
                                        <li class="dropdown-item notification-item">
                                            <a class="d-flex align-items-center" href="#">
                                                <div class="notification-icon bg-primary">
                                                    <i class="bi bi-cart-check"></i>
                                                </div>
                                                <div class="notification-text ms-4">
                                                    <p class="notification-title font-bold">Successfully check out</p>
                                                    <p class="notification-subtitle font-thin text-sm">Order ID #256</p>
                                                </div>
                                            </a>
                                        </li>
                                        <li class="dropdown-item notification-item">
                                            <a class="d-flex align-items-center" href="#">
                                                <div class="notification-icon bg-success">
                                                    <i class="bi bi-file-earmark-check"></i>
                                                </div>
                                                <div class="notification-text ms-4">
                                                    <p class="notification-title font-bold">Homework submitted</p>
                                                    <p class="notification-subtitle font-thin text-sm">Algebra math homework</p>
                                                </div>
                                            </a>
                                        </li>
                                        <li>
                                            <p class="text-center py-2 mb-0"><a href="#">See all notification</a></p>
                                        </li>
                                    </ul>
                                </li>
                            </ul>
                            <div class="dropdown">
                                <a href="#" data-bs-toggle="dropdown" aria-expanded="false">
                                    <div class="user-menu d-flex">
                                        <div class="user-name text-end me-3">
                                            <h6 class="mb-0 text-gray-600">John Ducky</h6>
                                            <p class="mb-0 text-sm text-gray-600">Administrator</p>
                                        </div>
                                        <div class="user-img d-flex align-items-center">
                                            <div class="avatar avatar-md">
                                                <img src="/assets/static/images/faces/1.jpg">
                                            </div>
                                        </div>
                                    </div>
                                </a>
                                <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownMenuButton" style="min-width: 11rem;">
                                    <li>
                                        <h6 class="dropdown-header">Hello, John!</h6>
                                    </li>
                                    <li><a class="dropdown-item" href="#"><i class="icon-mid bi bi-person me-2"></i> My
                                            Profile</a></li>
                                    <li><a class="dropdown-item" href="#"><i class="icon-mid bi bi-gear me-2"></i>
                                            Settings</a></li>
                                    <li><a class="dropdown-item" href="#"><i class="icon-mid bi bi-wallet me-2"></i>
                                            Wallet</a></li>
                                    <li>
                                        <hr class="dropdown-divider">
                                    </li>
                                    <li><a class="dropdown-item" href="/api/auth/logout/"><i
                                                class="icon-mid bi bi-box-arrow-left me-2"></i> Logout</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </nav>
            </header>
            <div id="main-content">
            <%= yield %>
            </div>
            <%= partial("_partials/footer.html") %>
        </div>
    </div>

    <!-- extensions js -->
    <%= javascriptTag("app.js") %>
    <%= javascriptTag("extensions/perfect-scrollbar/dist/perfect-scrollbar.min.js") %>
    <%= javascriptTag("extensions/bootstrap/dist/js/bootstrap.bundle.js") %>
    <%= javascriptTag("extensions/jquery-ujs/src/rails.js") %>
    
    <!-- ui components js -->
    <%= javascriptTag("static/js/components/dark.js") %>

    <script>
        function isDesktop(window) {
  return window.innerWidth > 1200;
}

/**
 * Calculate nested children height in sidebar menu
* @param {HTMLElement} el 
*/

  const calculateChildrenHeight = (el, deep = false) => {
    const children = el.children
    
    let height = 0
    for(let i = 0; i < el.childElementCount; i++) {
      const child = children[i]
      height += child.querySelector('.submenu-link').clientHeight

      // 2-level menu
      if(deep && child.classList.contains('has-sub')) {
        const subsubmenu = child.querySelector('.submenu')

        if(subsubmenu.classList.contains('submenu-open')) {
          const childrenHeight =  ~~[...subsubmenu.querySelectorAll('.submenu-link')].reduce((acc,curr) => acc + curr.clientHeight,0)
          height += childrenHeight
        }
      }
      
    }
    el.style.setProperty('--submenu-height', height + 'px')
    return height
  }

  /**
   * a Sidebar component
   * @param  {HTMLElement} el - sidebar element
   * @param  {object} options={} - options
   */
  class Sidebar {
    constructor(el, options = {}) {
      this.sidebarEL = el instanceof HTMLElement ? el : document.querySelector(el)
      this.options = options
      this.init()
    }

    /**
     * initialize the sidebar
     */
    init() {
      // add event listener to sidebar
      document
        .querySelectorAll(".burger-btn")
        .forEach((el) => el.addEventListener("click", this.toggle.bind(this)))
      document
        .querySelectorAll(".sidebar-hide")
        .forEach((el) => el.addEventListener("click", this.toggle.bind(this)))
      window.addEventListener("resize", this.onResize.bind(this))

      
      const toggleSubmenu = (el) => {
        if (el.classList.contains("submenu-open")) {
          el.classList.remove('submenu-open')
          el.classList.add('submenu-closed')
        } else {
          el.classList.remove("submenu-closed")
          el.classList.add("submenu-open")
        } 
      }

      


      let sidebarItems = document.querySelectorAll(".sidebar-item.has-sub")
      for (var i = 0; i < sidebarItems.length; i++) {
        let sidebarItem = sidebarItems[i]
        
        sidebarItems[i]
          .querySelector(".sidebar-link")
          .addEventListener("click", (e) => {
            e.preventDefault()
            let submenu = sidebarItem.querySelector(".submenu")
            toggleSubmenu(submenu)
          })
        
        
        // If submenu has submenu
        const submenuItems = sidebarItem.querySelectorAll('.submenu-item.has-sub') 
        submenuItems.forEach(item => {
          item.addEventListener('click', () => {
            const submenuLevelTwo = item.querySelector('.submenu')
            toggleSubmenu(submenuLevelTwo)
            
            // Pass second .submenu
            const height = calculateChildrenHeight(item.parentElement, true)

          })
        })
      }

      // Perfect Scrollbar Init
      if (typeof PerfectScrollbar == "function") {
        const container = document.querySelector(".sidebar-wrapper")
        const ps = new PerfectScrollbar(container, {
          wheelPropagation: false,
        })
      }

      // Scroll into active sidebar
      setTimeout(() => {
        this.forceElementVisibility(document.querySelector(".sidebar-item.active"))
      }, 300)

    }

    

    

    /**
     * On Sidebar Rezise Event
     */
    onResize() {
      if (isDesktop(window)) {
        this.sidebarEL.classList.add("active")
      } else {
        this.sidebarEL.classList.remove("active")
      }

      // reset
      this.deleteBackdrop()
      this.toggleOverflowBody(true)
    }

    /**
     * Toggle Sidebar
     */
    toggle() {
      const sidebarState = this.sidebarEL.classList.contains("active")
      if (sidebarState) {
        this.hide()
      } else {
        this.show()
      }
    }

    /**
     * Show Sidebar
     */
    show() {
      this.sidebarEL.classList.add("active")
      this.sidebarEL.classList.remove("inactive")
      this.createBackdrop()
      this.toggleOverflowBody()
    }

    /**
     * Hide Sidebar
     */
    hide() {
      this.sidebarEL.classList.remove("active")
      this.sidebarEL.classList.add("inactive")
      this.deleteBackdrop()
      this.toggleOverflowBody()
    }

    /**
     * Create Sidebar Backdrop
     */
    createBackdrop() {
      if (isDesktop(window)) return
      this.deleteBackdrop()
      const backdrop = document.createElement("div")
      backdrop.classList.add("sidebar-backdrop")
      backdrop.addEventListener("click", this.hide.bind(this))
      document.body.appendChild(backdrop)
    }

    /**
     * Delete Sidebar Backdrop
     */
    deleteBackdrop() {
      const backdrop = document.querySelector(".sidebar-backdrop")
      if (backdrop) {
        backdrop.remove()
      }
    }

    /**
     * Toggle Overflow Body
     */
    toggleOverflowBody(active) {
      if(isDesktop(window)) return;
      const sidebarState = this.sidebarEL.classList.contains("active")
      const body = document.querySelector("body")
      if (typeof active == "undefined") {
        body.style.overflowY = sidebarState ? "hidden" : "auto"
      } else {
        body.style.overflowY = active ? "auto" : "hidden"
      }
    }

    isElementInViewport(el) {
      var rect = el.getBoundingClientRect()

      return (
        rect.top >= 0 &&
        rect.left >= 0 &&
        rect.bottom <=
          (window.innerHeight || document.documentElement.clientHeight) &&
        rect.right <= (window.innerWidth || document.documentElement.clientWidth)
      )
    }

    forceElementVisibility(el) {
      if (!this.isElementInViewport(el)) {
        el.scrollIntoView(false)
      }
    }
  }



  let sidebarEl = document.getElementById("sidebar")

  /**
     * On First Load
     */
  const onFirstLoad = (sidebarEL) => {
    if(!sidebarEl) return
    if (isDesktop(window)) {
      sidebarEL.classList.add("active")
      sidebarEL.classList.add('sidebar-desktop')
    }

    // Get submenus size
    let submenus = document.querySelectorAll(".sidebar-item.has-sub .submenu")
    for (var i = 0; i < submenus.length; i++) {
      let submenu = submenus[i]
      const sidebarItem = submenu.parentElement
      const height = submenu.clientHeight
      
      if(sidebarItem.classList.contains('active')) submenu.classList.add('submenu-open')
      else submenu.classList.add('submenu-closed')
      setTimeout(() => {
        const height = calculateChildrenHeight(submenu, true)
      }, 50);
    }
  }

  if(document.readyState !== 'loading') {
    onFirstLoad(sidebarEl)
  }
  else {
    window.addEventListener('DOMContentLoaded', () => onFirstLoad(sidebarEl))
  }
  /**
   * Create Sidebar Wrapper
   */
  if (sidebarEl) {
    window.sidebar = new Sidebar(sidebarEl)
  }

    </script>

</body>

</html>